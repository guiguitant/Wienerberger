<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FDES Manager – Wienerberger</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css?v=6">
</head>
<body>

<!-- ══════════ SIDEBAR ══════════ -->
<aside class="sidebar">
  <div class="sidebar-brand">
    <div class="brand-icon">WB</div>
    <div class="brand-name">
      FDES Manager
      <small>Wienerberger</small>
    </div>
  </div>

  <div class="nav-section-label">Espace de travail</div>

  <a class="nav-item active" href="#" id="navDashboard" onclick="showView('viewDashboard'); return false;">
    <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
      <rect x=".5" y=".5" width="5.5" height="5.5" rx="1.2" fill="currentColor"/>
      <rect x="8" y=".5" width="5.5" height="5.5" rx="1.2" fill="currentColor"/>
      <rect x=".5" y="8" width="5.5" height="5.5" rx="1.2" fill="currentColor"/>
      <rect x="8" y="8" width="5.5" height="5.5" rx="1.2" fill="currentColor"/>
    </svg>
    Dashboard
  </a>

  <a class="nav-item" href="#" id="navContacts" onclick="openContacts(); return false;">
    <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
      <circle cx="5" cy="4.5" r="2.5" stroke="currentColor" stroke-width="1.5"/>
      <path d="M1 12c0-2.2 1.8-4 4-4s4 1.8 4 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
      <path d="M10 2v5M7.5 4.5h5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
    </svg>
    Contacts
  </a>

  <div class="sidebar-footer">
    <p>Chef de projet<br>Wienerberger France</p>
  </div>
</aside>

<!-- ══════════ MAIN CONTENT ══════════ -->
<div class="content">

  <div id="viewDashboard">
    <div class="topbar">
      <div class="page-title">Dashboard</div>
      <div class="page-sub">Vue d'ensemble de vos fiches environnementales</div>
    </div>

    <main>
      <!-- Stat cards -->
      <div class="stats" id="stats"></div>

      <!-- Progress bar -->
      <div class="progress-row" id="progressRow" style="display:none">
        <div class="progress-info">
          <div class="pct-val" id="progressPct">0%</div>
          <div class="pct-lbl">Vérifiées</div>
        </div>
        <div class="progress-divider"></div>
        <div class="progress-bar-wrap">
          <div class="progress-bar-label">Avancement global — FDES au statut Vérifié</div>
          <div class="progress-bar">
            <div class="progress-bar-fill" id="progressFill" style="width:0%"></div>
          </div>
        </div>
      </div>

      <!-- Toolbar -->
      <div class="toolbar">
        <h2>Mes FDES</h2>
        <button class="btn btn-primary" onclick="openModal()">
          <svg width="11" height="11" viewBox="0 0 11 11" fill="none">
            <path d="M5.5 1v9M1 5.5h9" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
          Nouvelle FDES
        </button>
      </div>

      <!-- Table -->
      <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th style="width:44px">#</th>
              <th>Nom du produit</th>
              <th style="width:150px">Bureau d'études</th>
              <th style="width:210px">Statut</th>
              <th style="width:140px">Deadline</th>
              <th style="width:120px">Ajoutée le</th>
              <th style="width:48px"></th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
        <div class="empty" id="empty" style="display:none">
          <div class="empty-icon">
            <svg width="22" height="22" viewBox="0 0 22 22" fill="none">
              <rect x="3" y="2" width="16" height="18" rx="2" stroke="#9b9b9b" stroke-width="1.5"/>
              <path d="M7 7h8M7 11h8M7 15h5" stroke="#9b9b9b" stroke-width="1.5" stroke-linecap="round"/>
            </svg>
          </div>
          <p>Aucune FDES pour l'instant.<br>Cliquez sur <strong>Nouvelle FDES</strong> pour commencer.</p>
        </div>
      </div>
    </main>
  </div><!-- /viewDashboard -->

  <div id="viewFdes">
    <div class="fdes-layout">

      <!-- Colonne gauche : infos FDES -->
      <div class="fdes-left">
        <button class="btn btn-ghost fdes-back-btn" onclick="closeFdes()">
          <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
            <path d="M9 2L4 7l5 5" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Dashboard
        </button>
        <div class="fdes-info-card" id="fdesInfoCard"></div>
      </div>

      <!-- Colonne droite : grille ou formulaire section -->
      <div class="fdes-right" id="fdesRightContent"></div>

    </div>
  </div><!-- /viewFdes -->

  <div id="viewContacts">
    <div class="topbar">
      <div class="page-title">Contacts</div>
      <div class="page-sub">Bureaux d'études et vérificateurs</div>
    </div>
    <main>
      <div class="contacts-page">
        <div class="contacts-block" id="blockBureau">
          <!-- rendered by JS -->
        </div>
        <div class="contacts-block" id="blockVerif">
          <!-- rendered by JS -->
        </div>
      </div>
    </main>
  </div><!-- /viewContacts -->

</div>

<!-- ══════════ MODAL ══════════ -->
<div class="overlay" id="overlay" onclick="handleOverlayClick(event)">
  <div class="modal">
    <div class="modal-header">
      <h3>Nouvelle FDES</h3>
      <button class="btn-icon" onclick="closeModal()" title="Fermer">
        <svg width="11" height="11" viewBox="0 0 11 11" fill="none">
          <path d="M1 1l9 9M10 1L1 10" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
        </svg>
      </button>
    </div>
    <div class="modal-body">
      <div>
        <label for="inputName">Nom du produit</label>
        <input type="text" id="inputName" placeholder="ex. Brique Porotherm 20" maxlength="100" />
        <div class="err" id="errName">Ce champ est requis.</div>
      </div>
      <div>
        <label for="inputBureau">Bureau d'études</label>
        <select class="form-select" id="inputBureau"></select>
      </div>
      <div>
        <label for="inputVerif">Vérificateur</label>
        <select class="form-select" id="inputVerif"></select>
      </div>
      <div>
        <label for="inputStatus">Statut initial</label>
        <select class="form-select" id="inputStatus">
          <option value="0">Lancement</option>
          <option value="1">En cours de collecte</option>
          <option value="2">En cours de modélisation</option>
          <option value="3">En cours de rapport</option>
          <option value="4">En cours de vérification</option>
          <option value="5">Vérifié</option>
        </select>
      </div>
      <div>
        <label for="inputDeadline">Deadline cible</label>
        <input type="date" id="inputDeadline" />
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal()">Annuler</button>
      <button class="btn btn-primary" onclick="addFdes()">Ajouter</button>
    </div>
  </div>
</div>

<!-- ══════════ MODAL CONTACT ══════════ -->
<div class="overlay" id="overlayContact" onclick="handleContactOverlayClick(event)">
  <div class="modal">
    <div class="modal-header">
      <h3 id="contactModalTitle">Nouveau contact</h3>
      <button class="btn-icon" onclick="closeContactModal()" title="Fermer">
        <svg width="11" height="11" viewBox="0 0 11 11" fill="none">
          <path d="M1 1l9 9M10 1L1 10" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
        </svg>
      </button>
    </div>
    <div class="modal-body">
      <div>
        <label for="inputContactNom">Nom</label>
        <input type="text" id="inputContactNom" placeholder="ex. Bureau Veritas" maxlength="100" />
        <div class="err" id="errContactNom">Ce champ est requis.</div>
      </div>
      <div>
        <label for="inputContactEmail">Email</label>
        <input type="email" id="inputContactEmail" placeholder="ex. contact@bureauveritas.com" maxlength="150" />
      </div>
      <div>
        <label for="inputContactTel">Téléphone</label>
        <input type="text" id="inputContactTel" placeholder="ex. +33 1 23 45 67 89" maxlength="30" />
      </div>
      <input type="hidden" id="inputContactType" value="bureau" />
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeContactModal()">Annuler</button>
      <button class="btn btn-primary" onclick="saveContact()">Enregistrer</button>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="js/app.js?v=6"></script>
</body>
</html>
